-- Création de la base de données
CREATE DATABASE IF NOT EXISTS `tifosi` CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE `tifosi`;

-- Création des tables
CREATE TABLE `marque` (
    `id_marque` INT AUTO_INCREMENT PRIMARY KEY,
    `nom` VARCHAR(50) NOT NULL
) ENGINE=InnoDB;

CREATE TABLE `boisson` (
    `id_boisson` INT AUTO_INCREMENT PRIMARY KEY,
    `nom` VARCHAR(50) NOT NULL
) ENGINE=InnoDB;

CREATE TABLE `appartient` (
    `id_boisson` INT NOT NULL,
    `id_marque` INT NOT NULL,
    PRIMARY KEY (`id_boisson`, `id_marque`),
    CONSTRAINT `fk_app_boisson` FOREIGN KEY (`id_boisson`) REFERENCES `boisson`(`id_boisson`),
    CONSTRAINT `fk_app_marque` FOREIGN KEY (`id_marque`) REFERENCES `marque`(`id_marque`)
) ENGINE=InnoDB;

CREATE TABLE `ingredient` (
    `id_ingredient` INT AUTO_INCREMENT PRIMARY KEY,
    `nom` VARCHAR(50) NOT NULL
) ENGINE=InnoDB;

CREATE TABLE `focaccia` (
    `id_focaccia` INT AUTO_INCREMENT PRIMARY KEY,
    `nom` VARCHAR(50) NOT NULL,
    `prix` DECIMAL(5,2) NOT NULL
) ENGINE=InnoDB;

CREATE TABLE `comprend` (
    `id_focaccia` INT NOT NULL,
    `id_ingredient` INT NOT NULL,
    PRIMARY KEY (`id_focaccia`, `id_ingredient`),
    CONSTRAINT `fk_comp_foc` FOREIGN KEY (`id_focaccia`) REFERENCES `focaccia`(`id_focaccia`),
    CONSTRAINT `fk_comp_ing` FOREIGN KEY (`id_ingredient`) REFERENCES `ingredient`(`id_ingredient`)
) ENGINE=InnoDB;

CREATE TABLE `client` (
    `id_client` INT AUTO_INCREMENT PRIMARY KEY,
    `nom` VARCHAR(45) NOT NULL,
    `email` VARCHAR(255) NOT NULL UNIQUE,
    `code_postal` INT NOT NULL
) ENGINE=InnoDB;

CREATE TABLE `menu` (
    `id_menu` INT AUTO_INCREMENT PRIMARY KEY,
    `nom` VARCHAR(45) NOT NULL,
    `prix` DECIMAL(5,2) NOT NULL
) ENGINE=InnoDB;

CREATE TABLE `contient` (
    `id_menu` INT NOT NULL,
    `id_boisson` INT NOT NULL,
    PRIMARY KEY (`id_menu`, `id_boisson`),
    CONSTRAINT `fk_cont_menu` FOREIGN KEY (`id_menu`) REFERENCES `menu`(`id_menu`),
    CONSTRAINT `fk_cont_bois` FOREIGN KEY (`id_boisson`) REFERENCES `boisson`(`id_boisson`)
) ENGINE=InnoDB;

CREATE TABLE `est_constitue` (
    `id_menu` INT NOT NULL,
    `id_focaccia` INT NOT NULL,
    PRIMARY KEY (`id_menu`, `id_focaccia`),
    CONSTRAINT `fk_const_menu` FOREIGN KEY (`id_menu`) REFERENCES `menu`(`id_menu`),
    CONSTRAINT `fk_const_foc` FOREIGN KEY (`id_focaccia`) REFERENCES `focaccia`(`id_focaccia`)
) ENGINE=InnoDB;

CREATE TABLE `achete` (
    `id_client` INT NOT NULL,
    `id_menu` INT NOT NULL,
    `date_achat` DATE NOT NULL,
    PRIMARY KEY (`id_client`, `id_menu`, `date_achat`),
    CONSTRAINT `fk_ach_client` FOREIGN KEY (`id_client`) REFERENCES `client`(`id_client`),
    CONSTRAINT `fk_ach_menu` FOREIGN KEY (`id_menu`) REFERENCES `menu`(`id_menu`)
) ENGINE=InnoDB;